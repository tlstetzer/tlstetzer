<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>The Mine</title>
	<link rel="icon" href="images/mineIcon.png">
	
	<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script> 
	<script src="themine.js"></script> 
	<script src="gameControl.js"></script>
</head>

<body onload="init();" style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(255, 255, 255, 1.00); width:1024px; height:768px">
		  <canvas id="canvas" 
				  width="1024" 
				  height="768" 
				  style="position: absolute; display: block; background-color:rgba(255, 255, 255, 1.00);">
		</canvas>
		  <div id="dom_overlay_container" 
			   style="pointer-events:none; overflow:hidden; width:1024px; height:768px; position: absolute; left: 0px; top: 0px; display: block;"> 
		</div>
	</div>
</body>

<!-- Initialize Stage -->
<script>
	// global variables
	var canvas, anim_container, dom_overlay_container, fnStartAnimation, stage, exportRoot;
	init();
	
	function init() {
		canvas = document.getElementById('canvas');
		anim_container = document.getElementById('animation_container');
		dom_overlay_container = document.getElementById('dom_overlay_container');
		
		// loader
		var comp = AdobeAn.getComposition('73B975183377F54C91972C7230FF1CDC');
		var comp_lib = comp.getLibrary();
		var loader = new createjs.LoadQueue(false);
		loader.addEventListener('fileload', function(evt) { handleFileLoad(evt,comp); });
		loader.addEventListener('complete', function(evt) { handleComplete(evt,comp); });
		loader.loadManifest(comp_lib.properties.manifest);
	}
	
	function handleFileLoad(evt, comp) {
		var images = comp.getImages();	
		if(evt && (evt.item.type == 'image')) { images[evt.item.id] = evt.result; }	
	}
	
	function handleComplete(evt, comp) {
		var compLib = comp.getLibrary();
		var ss = comp.getSpriteSheet();
		var queue = evt.target;
		var ssMetadata = compLib.ssMetadata;
		for(i=0; i<ssMetadata.length; i++) {
			ss[ssMetadata[i].name] = new createjs.SpriteSheet({"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames});
		}
		exportRoot = new compLib.gameBoard();
		stage = new compLib.Stage(canvas);

		// register tick event listener.
		fnStartAnimation = function() {
			stage.addChild(exportRoot);
			createjs.Ticker.framerate = compLib.properties.fps;
			createjs.Ticker.addEventListener('tick', stage);
		}
		
		// support for hidpi screens and responsive scaling
		AdobeAn.makeResponsive(true, 'both', true, 1, [canvas, anim_container, dom_overlay_container]);	
		AdobeAn.compositionLoaded(compLib.properties.id);
		
		// initialize game
		fnStartAnimation();
		gameInit(stage, exportRoot, compLib);
	}
</script>
</html>
